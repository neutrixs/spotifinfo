currentFetch=!1;const sleep=async function(b){return new Promise(c=>{setTimeout(c,b)})},getToken=async function(){if(currentFetch){for(;currentFetch;)await sleep(100);return}currentFetch=!0;let a;return a=await fetch("/gettoken"),a=await a.json(),a.relogback?void logOut(!1):void(window.localStorage.token=a.data.token,window.localStorage.validuntil=a.data.validuntil,currentFetch=!1)},getProfile=async function(){let a;if(a=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:window.localStorage.token}}),a=await a.json(),a.error)return void((401==a.error.status||400==a.error.status)&&(await getToken(),await sleep(1e3),await getProfile()));let b;b=a.images[0]?a.images[0].url:"/img/user.png",$("#profile").attr("src",b)},logOut=function(a){delete window.localStorage.token,delete window.localStorage.validuntil,delete window.localStorage.force,document.cookie.split(";").forEach(function(a){document.cookie=a.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")}),a&&(window.localStorage.force=!0),window.location.replace("/")};isDropdownOpened=!1;const dropdown=function(){isDropdownOpened?($("#dropdown").removeClass("r180"),$("#dropdown_options").addClass("none"),isDropdownOpened=!1):($("#dropdown").addClass("r180"),$("#dropdown_options").removeClass("none"),isDropdownOpened=!0)};isDropdownLocked=!1,$("#profile_h").click(function(){isDropdownLocked=!0,dropdown()}),$("#dropdown_options").click(function(){isDropdownLocked=!0}),$("#logout").click(function(){logOut(!0)}),$(window).click(function(){return isDropdownLocked?void(isDropdownLocked=!1):void(isDropdownOpened&&dropdown())}),isLoggedOut||getProfile();