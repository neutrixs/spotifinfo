const e=function(){$("#holder").addClass("margin0"),$("#nowPlaying").addClass("nowPlayingMobile")},t=function(){$("#holder").removeClass("margin0"),$("#nowPlaying").removeClass("nowPlayingMobile")};let o=44.5;$(window).width()/parseFloat($("body").css("font-size"))<o&&e(),$("#holder").removeClass("none").addClass("ts300ms"),window.onresize=function(){this.innerWidth;($(window).width()/parseFloat($("body").css("font-size"))<o?e:t)()},function(){let n=[];const t=async function(){let o=await fetch("https://api.spotify.com/v1/me/player/currently-playing",{method:"GET",headers:{Authorization:window.localStorage.token}});if(o=await o.json(),o.error)400!=o.error.status&&401!=o.error.status||(await h(),await t());else{let e=0;if(null!=o.item){o.item.name!==he.decode($("#mainTitle").html())&&(a(),$("#mainPicture").attr("src",o.item.album.images[0].url)),n=[o.progress_ms,o.item.duration_ms,o.is_playing],$("#nowPlayingStatus").html(o.is_playing?"Now Playing:":"Last Played Song:"),null==o.item&&$("#nowPlaying").addClass("none"),$("#nowPlaying").removeClass("none"),$("#mainPicture").off().on("click",function(){isMobile()?location.href=o.item.album.external_urls.spotify:window.open(o.item.album.external_urls.spotify)}),$("#mainTitle").html(o.item.name).off().on("click",function(){isMobile()?location.href=o.item.external_urls.spotify:window.open(o.item.external_urls.spotify)});let e="";for(i=0;i<o.item.artists.length;i++)e+=`<span id="mainArtist${i}" class="pointer">${o.item.artists[i].name}</span>`,i<o.item.artists.length-1&&(e+=", ");$("#mainArtist").html(e);let t="";for(i=0;i<o.item.artists.length;i++)t+=`artist${i}url = '${o.item.artists[i].external_urls.spotify}';$('#mainArtist${i}').off().on('click',()=>{if(isMobile()){location.href = artist${i}url}else{window.open(artist${i}url)}})\n`;eval(t),$("#nowPlaying").removeClass("none")}else $("#nowPlaying").addClass("none")}};if(!isLoggedOut){t();let e=setInterval(t,2e3)}let e=setInterval(()=>{var e,t,o,i;n[0]+=100,n[1]&&n[2]&&(i=n[0],o=n[1],e=Math.floor(o/6e4),t=((t=(Math.floor(o/1e3)%60).toString())<10?"0":"")+t,o=Math.floor(i/6e4),i=((i=(Math.floor(i/1e3)%60).toString())<10?"0":"")+i,$("#mainProgress").html(o+":"+i+" / "+e+":"+t))},100)}();let d="createElement",c="setAttribute",m="items",f="track",w="appendChild";const a=async function(){let r=await fetch("https://api.spotify.com/v1/me/player/recently-played?limit=50",{method:"GET",headers:{Authorization:window.localStorage.token}});if(r=await r.json(),r.error)401!=r.error.status&&400!=r.error.status||(await h(),await a());else{for($("#recentlyPlayedListHolder").html(""),i=0;i<r[m].length;i++){let e=document[d]("div");e[c]("id","RecentlyPlayed"+i),e[c]("class","listRecentlyPlayed");let t=document[d]("div");t[c]("id","recentlyPlayed"+i+"ImageHolder"),t[c]("class","recentlyPlayedImageHolder");let o=document[d]("img");o[c]("class","recentlyPlayedImage"),o[c]("src",r[m][i][f].album.images[1].url);let n=document[d]("div");n[c]("id","recentlyPlayed"+i+"InfoHolder"),n[c]("class","recentlyPlayedInfoHolder");let a=document[d]("p");a[c]("class","recentlyPlayedSongName"),a.innerHTML=r[m][i][f].name;let l=document[d]("p");for(l[c]("class","recentlyPlayedArtistName"),j=0;j<r[m][i][f].artists.length;j++){let e=document[d]("span");if(e[c]("id","recent"+i+"artist"+j),e.innerHTML=r[m][i][f].artists[j].name,l[w](e),j!=r[m][i][f].artists.length-1){let e=document[d]("span");e.innerHTML=", ",l[w](e)}}n[w](a),n[w](l),t[w](o),e[w](t),e[w](n);let s=document.getElementById("recentlyPlayedListHolder");s[w](e,s.childNodes[0])}for(i=0;i<r[m].length;i++)$(`#recentlyPlayed${i}InfoHolder`).off().on("click",{res:{...r},i:i},e=>{e=e.data.res[m][e.data.i][f].external_urls.spotify;isMobile()?location.href=e:window.open(e)}),$(`#recentlyPlayed${i}ImageHolder`).off().on("click",{res:{...r},i:i},e=>{e=e.data.res[m][e.data.i][f].album.external_urls.spotify;isMobile()?location.href=e:window.open(e)});$("#recentlyPlayed").removeClass("none")}};isLoggedOut||a(),function(){let a="";const t=new ColorThief;let o=document.getElementById("mainPicture");o.crossOrigin="Anonymous",o.addEventListener("load",function(){var e=t.getColor(o).join(",");a=[e,e],l(a[0]),s(a[1]),n()});const n=function(){$("#nowPlaying").css("background-color",`rgb(${"false"==window.localStorage.dark?a[1]:a[0]})`)},l=function(e){let t=[...e=e.split(",")];if(128<e.sort((e,t)=>e-t)[2]){var o=e[2]/128;for(i=0;i<t.length;i++)t[i]=Math.floor(t[i]/o);a[0]=t.join(",")}else if(e.sort((e,t)=>e-t)[2]<32){var n=32/e[2];for(i=0;i<t.length;i++)t[i]=Math.floor(t[i]*n);a[0]=t.join(",")}},s=function(e){let t=[...e=e.split(",")];if(e.sort((e,t)=>e-t)[2]<255){var o=255/e[2];for(i=0;i<t.length;i++)t[i]=Math.floor(t[i]*o);a[1]=t.join(",")}};$("#theme").on("click",function(){setTimeout(n,10)})}();const n=function(){if("false"==window.localStorage.dark){$("body")[0].classList.remove("bodyLight"),$("#nav").removeClass("navLight"),$("#dropdown_options").removeClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("black","white")),$("#theme_check").removeClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.remove("aLight");window.localStorage.dark=!0}else{$("body")[0].classList.add("bodyLight"),$("#nav").addClass("navLight"),$("#dropdown_options").addClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("white","black")),$("#theme_check").addClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.add("aLight");window.localStorage.dark=!1}},l=function(){$("body")[0].classList.add("bodyLight"),$("#nav").addClass("navLight"),$("#dropdown_options").addClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("white","black")),$("#theme_check").addClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.add("aLight")};"false"==window.localStorage.dark&&l(),$("#theme").on("click",n);let s=!1;const r=async function(o){return new Promise((e,t)=>{setTimeout(e,o)})},h=async function(){if(s)for(;s;)await r(100);else{s=!0;let e;e=await fetch("/gettoken"),e=await e.json(),e.relogback?u(!1):(window.localStorage.token=e.data.token,window.localStorage.validuntil=e.data.validuntil,s=!1)}},g=async function(){let t;if(t=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:window.localStorage.token}}),t=await t.json(),t.error)401!=t.error.status&&400!=t.error.status||(await h(),await r(1e3),await g());else{let e;e=t.images[0]?t.images[0].url:"/img/user.png",$("#profile").attr("src",e)}},u=function(e){delete window.localStorage.token,delete window.localStorage.validuntil,delete window.localStorage.force,document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),e&&(window.localStorage.force=!0),window.location.replace("/")};let p=!1;const y=function(){p=p?($("#dropdown").removeClass("r180"),$("#dropdown_options").addClass("none"),!1):($("#dropdown").addClass("r180"),$("#dropdown_options").removeClass("none"),!0)};let v=!1;$("#profile_h").click(function(){v=!0,y()}),$("#dropdown_options").click(function(){v=!0}),$("#logout").click(function(){u(!0)}),$(window).click(function(){v?v=!1:p&&y()}),isLoggedOut||g();