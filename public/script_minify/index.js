const e=function(){$("#holder").addClass("margin0"),$("#nowPlaying").addClass("nowPlayingMobile")},o=function(){$("#holder").removeClass("margin0"),$("#nowPlaying").removeClass("nowPlayingMobile")};let t=44.5;$(window).width()/parseFloat($("body").css("font-size"))<t&&e(),$("#holder").removeClass("none").addClass("ts300ms"),window.onresize=function(){width=this.innerWidth,emWidth=$(window).width()/parseFloat($("body").css("font-size")),(emWidth<t?e:o)()},function(){let n=[];const e=async function(){let o=await fetch("https://api.spotify.com/v1/me/player/currently-playing",{method:"GET",headers:{Authorization:window.localStorage.token}});if(o=await o.json(),o.error)400!=o.error.status&&401!=o.error.status||(await s(),await e());else if(nowPlayingStack=0,null!=o.item){o.item.name!==he.decode($("#mainTitle").html())&&(a(),$("#mainPicture").attr("src",o.item.album.images[0].url)),n=[o.progress_ms,o.item.duration_ms,o.is_playing],$("#nowPlayingStatus").html(o.is_playing?"Now Playing:":"Last Played Song:"),null==o.item&&$("#nowPlaying").addClass("none"),$("#nowPlaying").removeClass("none"),$("#mainPicture").off().on("click",function(){isMobile()?location.href=o.item.album.external_urls.spotify:window.open(o.item.album.external_urls.spotify)}),$("#mainTitle").html(o.item.name).off().on("click",function(){isMobile()?location.href=o.item.external_urls.spotify:window.open(o.item.external_urls.spotify)});let e="";for(i=0;i<o.item.artists.length;i++)e+=`<span id="mainArtist${i}" class="pointer">${o.item.artists[i].name}</span>`,i<o.item.artists.length-1&&(e+=", ");for($("#mainArtist").html(e),temp="",i=0;i<o.item.artists.length;i++)temp+=`artist${i}url = '${o.item.artists[i].external_urls.spotify}';$('#mainArtist${i}').off().on('click',()=>{if(isMobile()){location.href = artist${i}url}else{window.open(artist${i}url)}})\n`;eval(temp),$("#nowPlaying").removeClass("none")}else $("#nowPlaying").addClass("none")};isLoggedOut||(e(),nowPlayingInterval=setInterval(e,2e3));let o=setInterval(()=>{var e,o,t,i;n[0]+=100,n[1]&&n[2]&&(i=n[0],t=n[1],e=Math.floor(t/6e4),o=((o=(Math.floor(t/1e3)%60).toString())<10?"0":"")+o,t=Math.floor(i/6e4),i=((i=(Math.floor(i/1e3)%60).toString())<10?"0":"")+i,$("#mainProgress").html(t+":"+i+" / "+e+":"+o))},100)}();const a=async function(){let o=await fetch("https://api.spotify.com/v1/me/player/recently-played?limit=50",{method:"GET",headers:{Authorization:window.localStorage.token}});if(o=await o.json(),o.error)401!=o.error.status&&400!=o.error.status||(await s(),await a());else{let e="";for(i=0;i<o.items.length;i++){for(e+=`<div id="RecentlyPlayed${i}" class="listRecentlyPlayed"><div id="recentlyPlayed${i}ImageHolder" class="recentlyPlayedImageHolder"><img class="recentlyPlayedImage" src="${o.items[i].track.album.images[1].url}"></div><div id="recentlyPlayed${i}InfoHolder" class="recentlyPlayedInfoHolder"><p class="recentlyPlayedSongName">${o.items[i].track.name}</p><p class="recentlyPlayedArtistName">`,j=0;j<o.items[i].track.artists.length;j++)e+=`<span id="recent${i}artist${j}">${o.items[i].track.artists[j].name}</span>`,j!==o.items[i].track.artists.length-1&&(e+=", ");e+="</p></div></div>"}for($("#recentlyPlayedListHolder").html(e),e="",i=0;i<o.items.length;i++)e+=`$('#recentlyPlayed${i}InfoHolder').off().on('click',()=>{url = '${o.items[i].track.external_urls.spotify}';if(isMobile()){location.href = url}else{window.open(url)}});$('#recentlyPlayed${i}ImageHolder').off().on('click',()=>{url = '${o.items[i].track.album.external_urls.spotify}';if(isMobile()){location.href = url}else{window.open(url)}})\n`;eval(e),$("#recentlyPlayed").removeClass("none")}};isLoggedOut||a(),function(){let a="";const o=new ColorThief;let t=document.getElementById("mainPicture");t.crossOrigin="Anonymous",t.addEventListener("load",function(){var e=o.getColor(t).join(",");a=[e,e],l(a[0]),r(a[1]),n()});const n=function(){$("#nowPlaying").css("background-color",`rgb(${"false"==window.localStorage.dark?a[1]:a[0]})`)},l=function(e){let o=[...e=e.split(",")];if(128<e.sort((e,o)=>e-o)[2]){var t=e[2]/128;for(i=0;i<o.length;i++)o[i]=Math.floor(o[i]/t);a[0]=o.join(",")}else if(e.sort((e,o)=>e-o)[2]<32){var n=32/e[2];for(i=0;i<o.length;i++)o[i]=Math.floor(o[i]*n);a[0]=o.join(",")}},r=function(e){let o=[...e=e.split(",")];if(e.sort((e,o)=>e-o)[2]<255){var t=255/e[2];for(i=0;i<o.length;i++)o[i]=Math.floor(o[i]*t);a[1]=o.join(",")}};$("#theme").on("click",function(){setTimeout(n,10)})}();const n=function(){if("false"==window.localStorage.dark){$("body")[0].classList.remove("bodyLight"),$("#nav").removeClass("navLight"),$("#dropdown_options").removeClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("black","white")),$("#theme_check").removeClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.remove("aLight");window.localStorage.dark=!0}else{$("body")[0].classList.add("bodyLight"),$("#nav").addClass("navLight"),$("#dropdown_options").addClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("white","black")),$("#theme_check").addClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.add("aLight");window.localStorage.dark=!1}},l=function(){$("body")[0].classList.add("bodyLight"),$("#nav").addClass("navLight"),$("#dropdown_options").addClass("dropdown_optionsLight"),$("#dropdown").html($("#dropdown").html().replace("white","black")),$("#theme_check").addClass("none");let e=$("a");for(i=0;i<e.length;i++)e[i].classList.add("aLight")};"false"==window.localStorage.dark&&l(),$("#theme").on("click",n),currentFetch=!1;const r=async function(t){return new Promise((e,o)=>{setTimeout(e,t)})},s=async function(){if(currentFetch)for(;currentFetch;)await r(100);else{currentFetch=!0;let e;e=await fetch("/gettoken"),e=await e.json(),e.relogback?c(!1):(window.localStorage.token=e.data.token,window.localStorage.validuntil=e.data.validuntil,currentFetch=!1)}},d=async function(){let o;if(o=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:window.localStorage.token}}),o=await o.json(),o.error)401!=o.error.status&&400!=o.error.status||(await s(),await r(1e3),await d());else{let e;e=o.images[0]?o.images[0].url:"/img/user.png",$("#profile").attr("src",e)}},c=function(e){delete window.localStorage.token,delete window.localStorage.validuntil,delete window.localStorage.force,document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),e&&(window.localStorage.force=!0),window.location.replace("/")};isDropdownOpened=!1;const m=function(){isDropdownOpened=isDropdownOpened?($("#dropdown").removeClass("r180"),$("#dropdown_options").addClass("none"),!1):($("#dropdown").addClass("r180"),$("#dropdown_options").removeClass("none"),!0)};isDropdownLocked=!1,$("#profile_h").click(function(){isDropdownLocked=!0,m()}),$("#dropdown_options").click(function(){isDropdownLocked=!0}),$("#logout").click(function(){c(!0)}),$(window).click(function(){isDropdownLocked?isDropdownLocked=!1:isDropdownOpened&&m()}),isLoggedOut||d();