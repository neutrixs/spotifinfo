currentFetch=!1;const sleep=async function(t){return new Promise((o,e)=>{setTimeout(o,t)})},getToken=async function(){if(currentFetch)for(;currentFetch;)await sleep(100);else{currentFetch=!0;let o;o=await fetch("/gettoken"),o=await o.json(),o.relogback?logOut(!1):(window.localStorage.token=o.data.token,window.localStorage.validuntil=o.data.validuntil,currentFetch=!1)}},getProfile=async function(){let e;if(e=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:window.localStorage.token}}),e=await e.json(),e.error)401!=e.error.status&&400!=e.error.status||(await getToken(),await sleep(1e3),await getProfile());else{let o;o=e.images[0]?e.images[0].url:"/img/user.png",$("#profile").attr("src",o)}},logOut=function(o){delete window.localStorage.token,delete window.localStorage.validuntil,delete window.localStorage.force,document.cookie.split(";").forEach(function(o){document.cookie=o.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),o&&(window.localStorage.force=!0),window.location.replace("/")};isDropdownOpened=!1;const dropdown=function(){isDropdownOpened=isDropdownOpened?($("#dropdown").removeClass("r180"),$("#dropdown_options").addClass("none"),!1):($("#dropdown").addClass("r180"),$("#dropdown_options").removeClass("none"),!0)};isDropdownLocked=!1,$("#profile_h").click(function(){isDropdownLocked=!0,dropdown()}),$("#dropdown_options").click(function(){isDropdownLocked=!0}),$("#logout").click(function(){logOut(!0)}),$(window).click(function(){isDropdownLocked?isDropdownLocked=!1:isDropdownOpened&&dropdown()}),isLoggedOut||getProfile();